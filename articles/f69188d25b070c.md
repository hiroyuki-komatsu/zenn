---
title: "Bazel ã§ä½¿ç”¨ã™ã‚‹å¤–éƒ¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒæ›´æ–°ã•ã‚Œãªã„å•é¡Œã¨ãã®è§£æ±º"
emoji: "ğŸ”¨"
type: "tech"
topics:
  - "bazel"
published: true
published_at: "2023-04-30 19:50"
---

åˆç¨¿: 2023-04-30
å°æ¾å¼˜å¹¸ (@komatsuh)

## è¨˜äº‹ã®å†…å®¹
ãƒ“ãƒ«ãƒ‰ã‚·ã‚¹ãƒ†ãƒ ã® Bazel ã§ã€WORKSPACE.bazel ãƒ•ã‚¡ã‚¤ãƒ«ã«è¨­å®šã—ãŸå†…å®¹ãŒæœŸå¾…é€šã‚Šåæ˜ ã•ã‚Œãªã„å•é¡Œã«å¯¾ã—ã¦ã®ã€åŸå› ã¨è§£æ±ºæ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

## ç”¨èª
* Bazel: ãƒ“ãƒ«ãƒ‰ã‚·ã‚¹ãƒ†ãƒ ã€‚Make ã‚„ CMake ãªã©ã¨åŒã˜å½¹å‰²ã®ã‚‚ã®ã€‚ã“ã®è¨˜äº‹ã¯ Bazel ã«ã¤ã„ã¦ã¯ã™ã§ã«çŸ¥ã£ã¦ã„ã‚‹æ–¹ã‚€ã‘ã§ã™ã€‚
* WORKSPACE.bazel: Bazel ã§ä½¿ç”¨ã™ã‚‹è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã€‚ä¾å­˜ã™ã‚‹å¤–éƒ¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«ã¤ã„ã¦è¨­å®šãªã©ã‚’è¨˜è¿°ã—ã¾ã™ã€‚

## WORKSPACE.bazel ã«ã¤ã„ã¦

ãƒ“ãƒ«ãƒ‰ã‚·ã‚¹ãƒ†ãƒ ã® Bazel ã§å¤–éƒ¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã™ã‚‹ã«ã¯ã€WORKSPACE.bazel ã«è¨­å®šã‚’è¨˜è¿°ã—ã¾ã™ã€‚

ãŸã¨ãˆã°ã€ [Bazel skylib](https://github.com/bazelbuild/bazel-skylib) ã® [1.0.2](https://github.com/bazelbuild/bazel-skylib/releases/tag/1.0.2) ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã¯ä¸‹è¨˜ã®ã‚ˆã†ã«ã—ã¾ã™ã€‚

```py
# Bazel Skylib
http_archive(
    name = "bazel_skylib",
    sha256 = "97e70364e9249702246c0e9444bccdc4b847bed1eb03c5a3ece4f83dfe6abc44",
    urls = [
        "https://mirror.bazel.build/github.com/bazelbuild/bazel-skylib/releases/download/1.0.2/bazel-skylib-1.0.2.tar.gz",
        "https://github.com/bazelbuild/bazel-skylib/releases/download/1.0.2/bazel-skylib-1.0.2.tar.gz",
    ],
)
load("@bazel_skylib//:workspace.bzl", "bazel_skylib_workspace")
bazel_skylib_workspace()
```

## ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒæ›´æ–°ã•ã‚Œãªã„å•é¡Œã¨ãã®è§£æ±º

ã“ã‚Œã‚’ [1.4.1](https://github.com/bazelbuild/bazel-skylib/releases/tag/1.4.1) ã«æ›´æ–°ã™ã‚‹å ´åˆã¯ `sha256` ã¨ `urls` ã‚’é©åˆ‡ã«æ›¸ãæ›ãˆã‚Œã°ã‚ˆã„ã®ã§ã™ãŒã€æœŸå¾…é€šã‚Šã«æ›´æ–°ã•ã‚Œãªã„å•é¡Œã«é­é‡ã—ã¾ã—ãŸã€‚

èª¿ã¹ãŸçµæœã€ã“ã®è¨­å®šã®å‰ã«ã€åˆ¥ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒã™ã§ã«åŒã˜ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’èª­ã¿è¾¼ã‚“ã§ã„ãŸã“ã¨ãŒåŸå› ã§ã—ãŸã€‚

```py:NG
# Protocol buffers
# ã“ã®è¨­å®šãŒå†…éƒ¨çš„ã« Bazel Skylib 1.0.2 ã‚’è¨­å®šã—ã¦ã„ãŸ
local_repository(
    name = "com_google_protobuf",
    path = "third_party/protobuf",
)
load("@com_google_protobuf//:protobuf_deps.bzl", "protobuf_deps")
protobuf_deps()

# Bazel Skylib
# ã™ã§ã« Bazel Skylib 1.0.2 ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã®ã§ã€ãªã«ã‚‚ã—ãªã„
http_archive(
    name = "bazel_skylib",
    sha256 = "b8a1527901774180afc798aeb28c4634bdccf19c4d98e7bdd1ce79d1fe9aaad7",
    urls = [
        "https://mirror.bazel.build/github.com/bazelbuild/bazel-skylib/releases/download/1.4.1/bazel-skylib-1.4.1.tar.gz",
        "https://github.com/bazelbuild/bazel-skylib/releases/download/1.4.1/bazel-skylib-1.4.1.tar.gz",
    ],
)
load("@bazel_skylib//:workspace.bzl", "bazel_skylib_workspace")
bazel_skylib_workspace()
```

èª­ã¿è¾¼ã‚€é †ç•ªã‚’å…¥ã‚Œæ›¿ãˆã‚‹ã“ã¨ã§ã€æœŸå¾…ã—ãŸãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒèª­ã¿è¾¼ã¾ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚
```py:OK
# Bazel Skylib
# ãƒãƒ¼ã‚¸ãƒ§ãƒ³ 1.4.1 ã‚’è¨­å®šã™ã‚‹
http_archive(
    name = "bazel_skylib",
    sha256 = "b8a1527901774180afc798aeb28c4634bdccf19c4d98e7bdd1ce79d1fe9aaad7",
    urls = [
        "https://mirror.bazel.build/github.com/bazelbuild/bazel-skylib/releases/download/1.4.1/bazel-skylib-1.4.1.tar.gz",
        "https://github.com/bazelbuild/bazel-skylib/releases/download/1.4.1/bazel-skylib-1.4.1.tar.gz",
    ],
)
load("@bazel_skylib//:workspace.bzl", "bazel_skylib_workspace")
bazel_skylib_workspace()

# Protocol buffers
# ã™ã§ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹ Bazel Skylib 1.4.1 ã‚’ä½¿ç”¨ã™ã‚‹
local_repository(
    name = "com_google_protobuf",
    path = "third_party/protobuf",
)
load("@com_google_protobuf//:protobuf_deps.bzl", "protobuf_deps")
protobuf_deps()
```

ã‚ã‹ã£ã¦ã—ã¾ãˆã°ã€Œãªã‚‹ã»ã©ã­ã€ã¨ã„ã†è©±ãªã®ã§ã™ãŒã€åŸå› ã‚’ç‰¹å®šã™ã‚‹ã¾ã§ã«ã—ã°ã‚‰ãæ™‚é–“ãŒã‹ã‹ã£ã¦ã—ã¾ã£ãŸå•é¡Œã§ã—ãŸã€‚